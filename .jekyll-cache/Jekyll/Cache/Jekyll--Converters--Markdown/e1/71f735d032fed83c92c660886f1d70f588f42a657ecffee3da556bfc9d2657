I"√<hr />

<p>i recently stumpled upon this very nice <a href="https://github.com/LukeSmithxyz/emailwiz">emailwiz</a> script from LukeSmithxyz on github. Inspired by that a gave setting up my own mailserver another try. Its been running for weeks now and i had no troubles so far.</p>

<hr />

<h1 id="requirement">requirement</h1>

<hr />

<h1 id="modification">modification</h1>
<p>i modified the script a little bit more included the certbot stuff and patches some stuff i found on the github issues pages.
<a href="https://github.com/dni/scripts/server/install-email.sh">install-email</a></p>

<hr />

<h1 id="multiple-mailboxes-and-domains">multiple mailboxes and domains</h1>
<p>i browsed the web a little bit and found this 2 useful resources <a href="http://www.postfix.org/VIRTUAL_README.html">postfix virtual</a>
and <a href="https://www.linuxbabe.com/redhat/host-multiple-mail-domains-in-postfixadmin-centos-rhel">linuxbabe</a>.</p>

<ol>
  <li>you have to add a new unix user for each mailbox
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> useradd -aG mail newaccount
 passwd newaccount
</code></pre></div>    </div>
  </li>
  <li>expand the ssl certificate, you need to have the A and CNAME dns record working for the SSL certificate, see 5.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certbot certonly --webroot --agree-tos --text --non-interactive --webroot-path /var/www/html -d mail.domain1.com,mail.domain2.org --expand
</code></pre></div>    </div>
  </li>
  <li>generate the dkim keys and edit <code class="language-plaintext highlighter-rouge">/etc/postfix/dkim/signingtable</code> accordingly.
```
opendkim-genkey -b 2048 -d b1tco1n.org -D /etc/postfix/dkim/ -s mail-domain2 -v
chown opendkim:opendkim mail-domain2.private</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4. edit the file `/etc/postfix/virtual`.
for first time using more than 1 accounts you also need to configure postfix `main.cf` and add a file `virtual`.
important! do not add you main domain `domain1.com` to your `virtual_alias_domains`.
</code></pre></div></div>
<p>postconf -e ‚Äúvirtual_alias_domains = domain2.org‚Äù
postconf -e ‚Äúvirtual_alias_maps = hash:/etc/postfix/virtual‚Äù
cat ¬´EOF
postmaster@domain1.com   postmaster
office@domain1.com       oldaccount
admin@dnilabs.com        oldaccount
postmaster@domain2.org   postmaster
info@domain2.org         newaccount
EOF &gt; /etc/postfix/virtual</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

5. lastly add all the required dns record.
reverse dns is not needed multiple times it is fine if your main domain works.
note: replace `127.0.0.1` with your ip address.
</code></pre></div></div>
<p>A     domain2.org        ‚Äú127.0.0.1‚Äù
A     mail.domain2.org   ‚Äú127.0.0.1‚Äù
MX    domain2.org        ‚Äú10 mail.domain2.org‚Äù
TXT   domain2.org        ‚Äúv=spf1 mx a:mail.domain2.org -all‚Äù
TXT   _dmarc.domain2.org ‚Äúv=DMARC1; p=reject; rua=mailto:dmarc@domain2.org; fo=1‚Äù</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the domainkey TXT record you can `cat /etc/postfix/dkim/mail-domain2.txt`. i should look something like that:
</code></pre></div></div>
<p>TXT mail-domain2._domainkey.domain2.org ‚Äúv=DKIM1; h=sha256; k=rsa; "‚Äù
‚Äúp=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5yczbnqQ693qczb6IVET6c6HBvQtGoCizbqf4a0dJqqKdMqbVUcgyNh1TE7Ej+GJh4Q65zkNJ39SZ4MzJQbGffoffVB4IwAsql2dZiON9AhD6tSJfdeY7Cbz2LbRN4JID3JhLH/PWBGHJopPVzPiS/ccEOp+7W8KFTOl/AE5+08YBsdAMYwWbcWfa2FgonIQH/HHEpK5nFF5yJ‚Äù
‚ÄúX2McsrH0Bm4JvekHgUVaC08Upj2655mvAFWreUUTTWUWgfSKdcU4TyK2SEgB0OV/kSXgKUX5q+tGnFrynDuoKPYRY7CfIJhlzGlS+CESFnyVWGh3MnxQlpboNCCP2+m1UlFQML4wIDAQAB‚Äù
```</p>

<h1 id="mail-client---mutt">mail client - mutt</h1>
<p>i also use mutt for mail and i found this very nice <a href="https://github.com/LukeSmithxyz/mutt-wizard">mutt-wizard</a> script
also from LukeSmithxyz, for setting up the addresses. it is very well documented.
you need to install <code class="language-plaintext highlighter-rouge">neomutt</code> for this to work properly.</p>

<hr />

<h1 id="links">links</h1>

<ul>
  <li><a href="https://github.com/LukeSmithxyz/emailwiz">emailwiz</a></li>
  <li><a href="https://github.com/dni/scripts/server/install-email.sh">install-email</a></li>
  <li><a href="http://www.postfix.org/VIRTUAL_README.html">postfix virtual</a></li>
  <li><a href="https://www.linuxbabe.com/redhat/host-multiple-mail-domains-in-postfixadmin-centos-rhel">linuxbabe</a></li>
  <li><a href="https://github.com/LukeSmithxyz/mutt-wizard">mutt-wizard</a></li>
</ul>
:ET