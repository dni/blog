I"¾<hr />

<p>i recently stumpled upon this very nice <a href="https://github.com/LukeSmithxyz/emailwiz">emailwiz</a> script from LukeSmithxyz on github. Inspired by that a gave setting up my own mailserver another try. Its been running for weeks now and i had no troubles so far.</p>

<hr />

<h1 id="requirement">requirement</h1>

<hr />

<h1 id="modification">modification</h1>
<p>i modified the script a little bit more included the certbot stuff and patches some stuff i found on the github issues pages.
<a href="https://github.com/dni/scripts/server/install-email.sh">install-email</a></p>

<hr />

<h1 id="multiple-mailboxes-and-domains">multiple mailboxes and domains</h1>
<p>i browsed the web a little bit and found this 2 useful resources <a href="http://www.postfix.org/VIRTUAL_README.html">postfix virtual</a>
and <a href="https://www.linuxbabe.com/redhat/host-multiple-mail-domains-in-postfixadmin-centos-rhel">linuxbabe</a>.</p>

<ol>
  <li>you have to add a new unix user for each mailbox
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> useradd -aG mail newaccount
 passwd newaccount
</code></pre></div>    </div>
  </li>
  <li>expand the ssl certificate, you need to have the A and CNAME dns record working for the SSL certificate, see 5.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certbot certonly --webroot --agree-tos --text --non-interactive --webroot-path /var/www/html -d mail.domain1.com,mail.domain2.org --expand
</code></pre></div>    </div>
  </li>
  <li>generate the dkim keys
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certbot certonly --webroot --agree-tos --text --non-interactive --webroot-path /var/www/html -d mail.domain1.com,mail.domain2.org --expand
</code></pre></div>    </div>
  </li>
  <li>edit the file <code class="language-plaintext highlighter-rouge">/etc/postfix/virtual</code>.
for first time using more than 1 accounts you also need to configure postfix <code class="language-plaintext highlighter-rouge">main.cf</code> and add a file <code class="language-plaintext highlighter-rouge">virtual</code>.
important! do not add you main domain <code class="language-plaintext highlighter-rouge">domain1.com</code> to your <code class="language-plaintext highlighter-rouge">virtual_alias_domains</code>.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postconf -e "virtual_alias_domains = domain2.org"
postconf -e "virtual_alias_maps = hash:/etc/postfix/virtual"
cat &lt;&lt;EOF
postmaster@domain1.com   postmaster
office@domain1.com       oldaccount
admin@dnilabs.com        oldaccount
postmaster@domain2.org   postmaster
info@domain2.org         newaccount
EOF &gt; /etc/postfix/virtual
</code></pre></div>    </div>
  </li>
</ol>

<hr />

<ol>
  <li>lastly add all the required the required dns record.
reverse dns is not needed multiple times it should be fine if your main domain works
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A domain2.org 127.0.0.1
CNAME mail.domain2.org 127.0.0.1
MX domain2.org "10 mail.domain2.org"
TXT _dmarc.domain2.org "v=DMARC1; p=reject; rua=mailto:dmarc@b1tco1n.org; fo=1"
</code></pre></div>    </div>
  </li>
</ol>

<h1 id="mail-client---mutt">mail client - mutt</h1>
<p>i also use mutt for mail and i found this very nice <a href="https://github.com/LukeSmithxyz/mutt-wizard">mutt-wizard</a> script
also from LukeSmithxyz, for setting up the addresses. it is very well documented.
you need to install <code class="language-plaintext highlighter-rouge">neomutt</code> for this to work properly.</p>

<hr />

<h1 id="links">links</h1>

<ul>
  <li><a href="https://github.com/LukeSmithxyz/emailwiz">emailwiz</a></li>
  <li><a href="https://github.com/dni/scripts/server/install-email.sh">install-email</a></li>
  <li><a href="http://www.postfix.org/VIRTUAL_README.html">postfix virtual</a></li>
  <li><a href="https://www.linuxbabe.com/redhat/host-multiple-mail-domains-in-postfixadmin-centos-rhel">linuxbabe</a></li>
  <li><a href="https://github.com/LukeSmithxyz/mutt-wizard">mutt-wizard</a></li>
</ul>
:ET